import * as vscode from 'vscode';

type MessageArgs = (string | number)[];

interface NlsBundle {
  [key: string]: string;
}

const messages: { [locale: string]: NlsBundle } = {
  en: {
    'msg.textCopied': 'Text copied to clipboard',
    'msg.noSelection': 'No text selected',
    'msg.copyError': 'Failed to copy: {0}',
    'msg.bookmarkAdded': 'Bookmark added: {0}',
    'msg.noBookmarks': 'No bookmarks for this PDF.',
    'msg.noBookmarksToRemove': 'No bookmarks to remove.',
    'msg.bookmarkRemoved': 'Bookmark removed.',
    'msg.selectBookmark': 'Select a bookmark to jump to',
    'msg.selectBookmarkRemove': 'Select a bookmark to remove',
    'msg.enterPageNumber': 'Enter page number (1-{0})',
    'msg.invalidPageNumber': 'Please enter a number between 1 and {0}',
    'msg.exportSuccess': 'PDF exported to {0}',
    'msg.exportError': 'Failed to export PDF: {0}',
    'msg.selectZoomLevel': 'Select zoom level',
    'msg.selectScrollMode': 'Select scroll mode',
    'msg.selectSpreadMode': 'Select spread mode',
    'msg.selectCursorTool': 'Select cursor tool',
    'msg.nightModeOn': 'Night mode enabled',
    'msg.nightModeOff': 'Night mode disabled',
    'msg.presentationModeActive':
      'Presentation mode active. Press Escape to exit.',
    'msg.noRecentPositions': 'No recent positions.',
    'msg.selectRecentPosition': 'Select a recent position',
    'msg.recentPositionsCleared': 'Recent positions cleared.',
    'msg.statusBarTooltip': 'Click to go to page',
    'msg.page': 'Page {0}',
    'command.export': 'Export PDF',
    'zoom.auto': 'Auto',
    'zoom.actualSize': 'Actual Size',
    'zoom.pageFit': 'Page Fit',
    'zoom.pageWidth': 'Page Width',
    'scroll.vertical': 'Vertical Scrolling',
    'scroll.horizontal': 'Horizontal Scrolling',
    'scroll.wrapped': 'Wrapped Scrolling',
    'scroll.page': 'Page Scrolling',
    'spread.none': 'No Spreads',
    'spread.odd': 'Odd Spreads',
    'spread.even': 'Even Spreads',
    'cursor.select': 'Text Selection Tool',
    'cursor.hand': 'Hand Tool',
    'msg.pathCopied': 'Path copied: {0}',
    'msg.fileName': 'File name',
    'msg.fileSize': 'File size',
    'msg.fileCreated': 'Created',
    'msg.fileModified': 'Modified',
    'msg.filePath': 'Path',
    'msg.fileInfoError': 'Failed to get file info: {0}',
    'msg.noAnnotations': 'No annotations found in this PDF.',
    'msg.annotationsExported': 'Annotations exported to {0}',
    'msg.annotationsExportError': 'Failed to export annotations: {0}',
    'msg.annotationsCopied': 'Annotations copied to clipboard',
    'msg.noBackHistory': 'No back history available.',
    'msg.noForwardHistory': 'No forward history available.',
    'msg.noTextToExtract': 'No text found to extract.',
    'msg.selectExtractAction': 'Select what to do with extracted text',
    'msg.textExtractedCopied': 'Text copied to clipboard.',
    'msg.textExtractedSaved': 'Text saved to {0}',
    'msg.extractError': 'Failed to extract text: {0}',
    'msg.extractingText': 'Extracting text from {0} pages...',
    'msg.autoScrollStarted':
      'Auto scroll started. Press the shortcut again to stop.',
    'msg.autoScrollStopped': 'Auto scroll stopped.',
    'msg.selectScrollSpeed': 'Select scroll speed',
    'msg.enterPageNote': 'Enter note for page {0}',
    'msg.noteplaceholder': 'Type your note here...',
    'msg.noteDeleted': 'Note deleted.',
    'msg.noteSaved': 'Note saved.',
    'msg.noNotes': 'No notes for this PDF.',
    'msg.selectPageNote': 'Select a note to jump to',
    'msg.notesExported': 'Notes exported to {0}',
    'msg.enterPercent': 'Enter percentage (0-100)',
    'msg.invalidPercent': 'Please enter a number between 0 and 100',
    'msg.selectColorMode': 'Select color mode',
    'msg.colorModeChanged': 'Color mode changed to {0}',
    'msg.selectQuickJump': 'Select position to jump to',
    'msg.pageInfoCopied': 'Page info copied to clipboard.',
    'msg.pageLinkCopied': 'Page link copied to clipboard.',
    'extract.copyToClipboard': 'Copy to Clipboard',
    'extract.saveToFile': 'Save to File',
    'extract.openInEditor': 'Open in Editor',
    'extract.openAsMarkdown': 'Open as Markdown',
    'msg.enterPageRangeForText': 'Enter page range (1-{0}) for text extraction',
    'autoScroll.slow': 'Slow',
    'autoScroll.normal': 'Normal',
    'autoScroll.fast': 'Fast',
    'autoScroll.veryFast': 'Very Fast',
    'colorMode.normal': 'Normal',
    'colorMode.night': 'Night Mode',
    'colorMode.grayscale': 'Grayscale',
    'colorMode.sepia': 'Sepia',
    'colorMode.highContrast': 'High Contrast',
    'quickJump.first': 'First Page (0%)',
    'quickJump.quarter': 'Quarter (25%)',
    'quickJump.half': 'Half (50%)',
    'quickJump.threeQuarters': 'Three Quarters (75%)',
    'quickJump.last': 'Last Page (100%)',
    'msg.enterPageRange': 'Enter page range (1-{0}), e.g. 1-5, 8, 10-12',
    'msg.pageRangePlaceholder': 'e.g. 1-5, 8, 10-12',
    'msg.invalidPageRange': 'Invalid page range format',
    'msg.noValidPages': 'No valid pages in the range',
    'msg.captureAllPagesWarning':
      'This will capture all {0} pages as images. Continue?',
    'msg.selectPdfToCompare': 'Select a PDF file to compare',
    'msg.compareViewOpened': 'Comparison view opened',
    'msg.enterPrintRange': 'Enter page range to print (1-{0})',
    'msg.markdownLinkCopied': 'Markdown link copied to clipboard',
    'msg.confirmClearHighlights': 'Clear all highlights in this document?',
    'btn.confirm': 'Confirm',
    'extract.saveAsImages': 'Save as Images',
    'extract.copyFirstPage': 'Copy First Page',
    'msg.selectFolder': 'Select Folder',
    'msg.pagesExported': 'Pages exported to {0}',
    'msg.imageCopied': 'Image copied to clipboard',
    'msg.documentMetadata': 'Document Metadata',
    'metadata.title': 'Title',
    'metadata.author': 'Author',
    'metadata.subject': 'Subject',
    'metadata.keywords': 'Keywords',
    'metadata.creator': 'Creator',
    'metadata.producer': 'Producer',
    'metadata.creationDate': 'Creation Date',
    'metadata.modificationDate': 'Modification Date',
    'metadata.pageCount': 'Page Count',
    'metadata.pdfVersion': 'PDF Version',
    'metadata.isLinearized': 'Linearized',
    'metadata.isAcroFormPresent': 'AcroForm Present',
    'metadata.isXFAPresent': 'XFA Present',
    // 阅读统计
    'msg.noReadingStats': 'No reading statistics available.',
    'msg.confirmClearStats': 'Clear all reading statistics for this document?',
    'msg.statsCleared': 'Reading statistics cleared.',
    'stats.title': 'Reading Statistics',
    'stats.fileName': 'File Name',
    'stats.totalPages': 'Total Pages',
    'stats.pagesRead': 'Pages Read',
    'stats.progress': 'Progress',
    'stats.totalReadingTime': 'Total Reading Time',
    'stats.sessionTime': 'Current Session',
    'stats.estimatedRemaining': 'Estimated Remaining',
    'stats.lastPage': 'Last Page',
    'stats.pagesVisited': 'Pages Visited',
    'stats.minutes': ' min',
    'stats.seconds': ' sec',
    'stats.minShort': 'm',
    // 搜索历史
    'msg.noSearchHistory': 'No search history.',
    'msg.searchResults': '{0} results',
    'msg.selectSearchHistory': 'Select a search to repeat',
    'msg.confirmClearSearchHistory': 'Clear all search history?',
    'msg.searchHistoryCleared': 'Search history cleared.',
    // 书签导入导出
    'msg.bookmarksExported': 'Bookmarks exported to {0}',
    'msg.selectBookmarksFile': 'Select bookmarks file to import',
    'msg.invalidBookmarksFile': 'Invalid bookmarks file format.',
    'msg.selectImportMode': 'Select import mode',
    'msg.bookmarksImported': '{0} bookmarks imported.',
    'msg.bookmarksImportError': 'Failed to import bookmarks: {0}',
    'import.merge': 'Merge with existing',
    'import.replace': 'Replace all',
    // 状态栏增强
    'msg.statusBarTooltipEnhanced':
      'Page {0}/{1} | Progress: {2}% | ~{3} min remaining',
    // 快捷键帮助
    'shortcuts.title': 'Keyboard Shortcuts',
    'shortcuts.key': 'Shortcut',
    'shortcuts.action': 'Action',
    'shortcut.gotoPage': 'Go to Page',
    'shortcut.prevNextPage': 'Previous/Next Page',
    'shortcut.firstLastPage': 'First/Last Page',
    'shortcut.zoomInOut': 'Zoom In/Out',
    'shortcut.actualSize': 'Actual Size',
    'shortcut.fitWidthPage': 'Fit Width/Page',
    'shortcut.find': 'Find in Document',
    'shortcut.toggleSidebar': 'Toggle Sidebar',
    'shortcut.addBookmark': 'Add Bookmark',
    'shortcut.showBookmarks': 'Show Bookmarks',
    'shortcut.nightMode': 'Toggle Night Mode',
    'shortcut.presentationMode': 'Presentation Mode',
    'shortcut.backForward': 'Navigate Back/Forward',
    'shortcut.extractText': 'Extract Page Text',
    'shortcut.addNote': 'Add Page Note',
    'shortcut.quickJump': 'Quick Jump',
    // 文本操作
    'msg.webSearch': 'Search on Web',
    'msg.translateText': 'Translate',
    'msg.selectedTextCopied': 'Selected text with page info copied.',
    'msg.searchInDocument': 'Search in Document',
    'msg.selectSearchAction': 'Select search action',
    'msg.outline': 'Outline',
    'msg.bookmark': 'Bookmark',
    'msg.noOutlineOrBookmarks': 'No outline or bookmarks found.',
    'msg.selectOutlineOrBookmark': 'Select outline item or bookmark',
    // 高亮颜色
    'highlight.yellow': 'Yellow',
    'highlight.green': 'Green',
    'highlight.blue': 'Blue',
    'highlight.pink': 'Pink',
    'highlight.orange': 'Orange',
    'highlight.purple': 'Purple',
    'highlight.red': 'Red',
    'highlight.cyan': 'Cyan',
    'highlight.custom': 'Custom Color...',
    'msg.selectHighlightColor': 'Select highlight color',
    'msg.enterCustomColor': 'Enter custom color (e.g. #FF0000)',
    'msg.invalidColorFormat': 'Invalid color format. Use #RRGGBB',
    'msg.highlightColorSet': 'Highlight color set to {0}',
    'msg.noHighlights': 'No highlights in this document.',
    'msg.highlightAdded': 'Highlight added ({0} total)',
    'msg.highlightRemoved': 'Highlight removed ({0} remaining)',
    'msg.highlightIndex': '{0} of {1}',
    'msg.highlightColor': 'Color: {0}',
    'msg.selectHighlight': 'Select highlight ({0} total)',
    'msg.selectHighlightAction': 'Select action for this highlight',
    'action.jumpTo': 'Jump to Highlight',
    'action.delete': 'Delete Highlight',
    'action.copyText': 'Copy Text',
    'action.deleteAll': 'Delete All Highlights',
    'msg.highlightsCleared': '{0} highlights cleared.',
    'msg.highlightsRestored': '{0} highlights restored.',
  },
  'zh-cn': {
    'msg.textCopied': '文本已复制到剪贴板',
    'msg.noSelection': '没有选中文本',
    'msg.copyError': '复制失败：{0}',
    'msg.bookmarkAdded': '书签已添加：{0}',
    'msg.noBookmarks': '此 PDF 没有书签。',
    'msg.noBookmarksToRemove': '没有可删除的书签。',
    'msg.bookmarkRemoved': '书签已删除。',
    'msg.selectBookmark': '选择要跳转的书签',
    'msg.selectBookmarkRemove': '选择要删除的书签',
    'msg.enterPageNumber': '输入页码（1-{0}）',
    'msg.invalidPageNumber': '请输入 1 到 {0} 之间的数字',
    'msg.exportSuccess': 'PDF 已导出到 {0}',
    'msg.exportError': '导出 PDF 失败：{0}',
    'msg.selectZoomLevel': '选择缩放级别',
    'msg.selectScrollMode': '选择滚动模式',
    'msg.selectSpreadMode': '选择分页模式',
    'msg.selectCursorTool': '选择光标工具',
    'msg.nightModeOn': '夜间模式已启用',
    'msg.nightModeOff': '夜间模式已禁用',
    'msg.presentationModeActive': '演示模式已激活。按 Escape 键退出。',
    'msg.noRecentPositions': '没有最近位置。',
    'msg.selectRecentPosition': '选择最近位置',
    'msg.recentPositionsCleared': '最近位置已清除。',
    'msg.statusBarTooltip': '点击跳转到页面',
    'msg.page': '第 {0} 页',
    'zoom.auto': '自动',
    'zoom.actualSize': '实际大小',
    'zoom.pageFit': '适合页面',
    'zoom.pageWidth': '适合宽度',
    'scroll.vertical': '垂直滚动',
    'scroll.horizontal': '水平滚动',
    'scroll.wrapped': '平铺滚动',
    'scroll.page': '单页滚动',
    'spread.none': '无分页',
    'spread.odd': '奇数分页',
    'spread.even': '偶数分页',
    'cursor.select': '文本选择工具',
    'cursor.hand': '手型工具',
    'msg.pathCopied': '路径已复制：{0}',
    'msg.fileName': '文件名',
    'msg.fileSize': '文件大小',
    'msg.fileCreated': '创建时间',
    'msg.fileModified': '修改时间',
    'msg.filePath': '路径',
    'msg.fileInfoError': '获取文件信息失败：{0}',
    'msg.noAnnotations': '此 PDF 中没有注释。',
    'msg.annotationsExported': '注释已导出到 {0}',
    'msg.annotationsExportError': '导出注释失败：{0}',
    'msg.annotationsCopied': '注释已复制到剪贴板',
    'msg.noBackHistory': '没有返回历史。',
    'msg.noForwardHistory': '没有前进历史。',
    'msg.noTextToExtract': '没有可提取的文本。',
    'msg.selectExtractAction': '选择如何处理提取的文本',
    'msg.textExtractedCopied': '文本已复制到剪贴板。',
    'msg.textExtractedSaved': '文本已保存到 {0}',
    'msg.extractError': '文本提取失败：{0}',
    'msg.extractingText': '正在从 {0} 页提取文本...',
    'msg.autoScrollStarted': '自动滚动已开始。再次按快捷键停止。',
    'msg.autoScrollStopped': '自动滚动已停止。',
    'msg.selectScrollSpeed': '选择滚动速度',
    'msg.enterPageNote': '输入第 {0} 页的笔记',
    'msg.noteplaceholder': '在此输入笔记...',
    'msg.noteDeleted': '笔记已删除。',
    'msg.noteSaved': '笔记已保存。',
    'msg.noNotes': '此 PDF 没有笔记。',
    'msg.selectPageNote': '选择要跳转的笔记',
    'msg.notesExported': '笔记已导出到 {0}',
    'msg.enterPercent': '输入百分比（0-100）',
    'msg.invalidPercent': '请输入 0 到 100 之间的数字',
    'msg.selectColorMode': '选择颜色模式',
    'msg.colorModeChanged': '颜色模式已更改为 {0}',
    'msg.selectQuickJump': '选择跳转位置',
    'msg.pageInfoCopied': '页面信息已复制到剪贴板。',
    'msg.pageLinkCopied': '页面链接已复制到剪贴板。',
    'extract.copyToClipboard': '复制到剪贴板',
    'extract.saveToFile': '保存到文件',
    'extract.openInEditor': '在编辑器中打开',
    'extract.openAsMarkdown': '以 Markdown 打开',
    'msg.enterPageRangeForText': '输入要提取文本的页面范围（1-{0}）',
    'autoScroll.slow': '慢速',
    'autoScroll.normal': '正常',
    'autoScroll.fast': '快速',
    'autoScroll.veryFast': '极快',
    'colorMode.normal': '正常',
    'colorMode.night': '夜间模式',
    'colorMode.grayscale': '灰度',
    'colorMode.sepia': '护眼（棕褐色）',
    'colorMode.highContrast': '高对比度',
    'quickJump.first': '首页 (0%)',
    'quickJump.quarter': '四分之一 (25%)',
    'quickJump.half': '中间 (50%)',
    'quickJump.threeQuarters': '四分之三 (75%)',
    'quickJump.last': '末页 (100%)',
    'msg.enterPageRange': '输入页面范围（1-{0}），例如 1-5, 8, 10-12',
    'msg.pageRangePlaceholder': '例如 1-5, 8, 10-12',
    'msg.invalidPageRange': '页面范围格式无效',
    'msg.noValidPages': '范围内没有有效页面',
    'msg.captureAllPagesWarning': '这将把所有 {0} 页截图为图片。继续？',
    'msg.selectPdfToCompare': '选择要比较的 PDF 文件',
    'msg.compareViewOpened': '比较视图已打开',
    'msg.enterPrintRange': '输入要打印的页面范围（1-{0}）',
    'msg.markdownLinkCopied': 'Markdown 链接已复制到剪贴板',
    'msg.confirmClearHighlights': '清除此文档中的所有高亮？',
    'btn.confirm': '确认',
    'extract.saveAsImages': '保存为图片',
    'extract.copyFirstPage': '复制第一页',
    'msg.selectFolder': '选择文件夹',
    'msg.pagesExported': '页面已导出到 {0}',
    'msg.imageCopied': '图片已复制到剪贴板',
    'msg.documentMetadata': '文档元数据',
    'metadata.title': '标题',
    'metadata.author': '作者',
    'metadata.subject': '主题',
    'metadata.keywords': '关键词',
    'metadata.creator': '创建程序',
    'metadata.producer': '生成程序',
    'metadata.creationDate': '创建日期',
    'metadata.modificationDate': '修改日期',
    'metadata.pageCount': '页数',
    'metadata.pdfVersion': 'PDF 版本',
    'metadata.isLinearized': '线性化',
    'metadata.isAcroFormPresent': '包含 AcroForm',
    'metadata.isXFAPresent': '包含 XFA',
    // 阅读统计
    'msg.noReadingStats': '暂无阅读统计数据。',
    'msg.confirmClearStats': '清除此文档的所有阅读统计？',
    'msg.statsCleared': '阅读统计已清除。',
    'stats.title': '阅读统计',
    'stats.fileName': '文件名',
    'stats.totalPages': '总页数',
    'stats.pagesRead': '已读页数',
    'stats.progress': '阅读进度',
    'stats.totalReadingTime': '总阅读时间',
    'stats.sessionTime': '本次会话',
    'stats.estimatedRemaining': '预计剩余',
    'stats.lastPage': '上次阅读',
    'stats.pagesVisited': '已访问页面',
    'stats.minutes': ' 分钟',
    'stats.seconds': ' 秒',
    'stats.minShort': '分钟',
    // 搜索历史
    'msg.noSearchHistory': '暂无搜索历史。',
    'msg.searchResults': '{0} 个结果',
    'msg.selectSearchHistory': '选择要重复的搜索',
    'msg.confirmClearSearchHistory': '清除所有搜索历史？',
    'msg.searchHistoryCleared': '搜索历史已清除。',
    // 书签导入导出
    'msg.bookmarksExported': '书签已导出到 {0}',
    'msg.selectBookmarksFile': '选择要导入的书签文件',
    'msg.invalidBookmarksFile': '书签文件格式无效。',
    'msg.selectImportMode': '选择导入模式',
    'msg.bookmarksImported': '已导入 {0} 个书签。',
    'msg.bookmarksImportError': '导入书签失败：{0}',
    'import.merge': '与现有合并',
    'import.replace': '替换全部',
    // 状态栏增强
    'msg.statusBarTooltipEnhanced':
      '第 {0}/{1} 页 | 进度: {2}% | 预计剩余 {3} 分钟',
    // 快捷键帮助
    'shortcuts.title': '快捷键帮助',
    'shortcuts.key': '快捷键',
    'shortcuts.action': '功能',
    'shortcut.gotoPage': '跳转到页面',
    'shortcut.prevNextPage': '上一页/下一页',
    'shortcut.firstLastPage': '第一页/最后一页',
    'shortcut.zoomInOut': '放大/缩小',
    'shortcut.actualSize': '实际大小',
    'shortcut.fitWidthPage': '适合宽度/页面',
    'shortcut.find': '查找',
    'shortcut.toggleSidebar': '切换侧边栏',
    'shortcut.addBookmark': '添加书签',
    'shortcut.showBookmarks': '显示书签',
    'shortcut.nightMode': '切换夜间模式',
    'shortcut.presentationMode': '演示模式',
    'shortcut.backForward': '后退/前进',
    'shortcut.extractText': '提取页面文本',
    'shortcut.addNote': '添加页面笔记',
    'shortcut.quickJump': '快速跳转',
    // 文本操作
    'msg.webSearch': '网页搜索',
    'msg.translateText': '翻译',
    'msg.selectedTextCopied': '已复制选中文本及页码信息。',
    'msg.searchInDocument': '在文档中搜索',
    'msg.selectSearchAction': '选择搜索操作',
    'msg.outline': '大纲',
    'msg.bookmark': '书签',
    'msg.noOutlineOrBookmarks': '未找到大纲或书签。',
    'msg.selectOutlineOrBookmark': '选择大纲项或书签',
    // 高亮颜色
    'highlight.yellow': '黄色',
    'highlight.green': '绿色',
    'highlight.blue': '蓝色',
    'highlight.pink': '粉色',
    'highlight.orange': '橙色',
    'highlight.purple': '紫色',
    'highlight.red': '红色',
    'highlight.cyan': '青色',
    'highlight.custom': '自定义颜色...',
    'msg.selectHighlightColor': '选择高亮颜色',
    'msg.enterCustomColor': '输入自定义颜色（例如 #FF0000）',
    'msg.invalidColorFormat': '颜色格式无效。请使用 #RRGGBB',
    'msg.highlightColorSet': '高亮颜色已设置为 {0}',
    'msg.noHighlights': '此文档中没有高亮。',
    'msg.highlightAdded': '已添加高亮（共 {0} 个）',
    'msg.highlightRemoved': '已删除高亮（剩余 {0} 个）',
    'msg.highlightIndex': '第 {0}/{1} 个',
    'msg.highlightColor': '颜色: {0}',
    'msg.selectHighlight': '选择高亮（共 {0} 个）',
    'msg.selectHighlightAction': '选择要执行的操作',
    'action.jumpTo': '跳转到高亮',
    'action.delete': '删除高亮',
    'action.copyText': '复制文本',
    'action.deleteAll': '删除所有高亮',
    'msg.highlightsCleared': '已清除 {0} 个高亮。',
    'msg.highlightsRestored': '已恢复 {0} 个高亮。',
  },
};

export function t(key: string, ...args: MessageArgs): string {
  const locale = vscode.env.language.toLowerCase();
  const bundle = messages[locale] || messages['zh-cn'] || messages['en'];
  let message = bundle[key] || messages['en'][key] || key;

  args.forEach((arg, index) => {
    message = message.replace(`{${index}}`, String(arg));
  });

  return message;
}

export function getWebviewLocale(): string {
  const lang = vscode.env.language.toLowerCase();
  const localeMap: { [key: string]: string } = {
    'zh-cn': 'zh-CN',
    'zh-tw': 'zh-TW',
    en: 'en-US',
    'en-us': 'en-US',
    'en-gb': 'en-GB',
    ja: 'ja',
    ko: 'ko',
    de: 'de',
    fr: 'fr',
    es: 'es-ES',
    'pt-br': 'pt-BR',
    ru: 'ru',
    it: 'it',
  };

  return localeMap[lang] || localeMap[lang.split('-')[0]] || 'en-US';
}
